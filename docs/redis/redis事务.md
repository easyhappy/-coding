---
title: 2022年Redis最新面试题 - Redis事务
author: 漫步coding
date: '2022-4-9'
---


### 事务

- 怎么理解 Redis 事务？
- Redis事务执行过程
- Redis事务的一些使用场景
- Redis事务与Redis pipeline的区别


#### 怎么理解 Redis 事务？

出现概率: ★★★★

Redis事务的本质是一组命令的集合。事务支持一次执行多个命令，一个事务中所有命令都会被序列化。在事务执行过程，会按照顺序串行化执行队列中的命令，其他客户端提交的命令请求不会插入到事务执行命令序列中。 总结说：Redis事务就是一次性、顺序性、排他性的执行一个队列中的一系列命令。 

 1)、Redis事务相关命令和使用 

 MULTI 、 EXEC 、 DISCARD 和 WATCH 是 Redis 事务相关的命令。 

 - MULTI ：开启事务，redis会将后续的命令逐个放入队列中，然后使用EXEC命令来原子化执行这个命令系列。 
 - EXEC：执行事务中的所有操作命令。
 - DISCARD：取消事务，放弃执行事务块中的所有命令。 
 - WATCH：监视一个或多个key,如果事务在执行前，这个key(或多个key)被其他命令修改，则事务被中断，不会执行事务中的任何命令。 
 - UNWATCH：取消WATCH对所有key的监视。


```
127.0.0.1:6379> MULTI
OK
127.0.0.1:6379> SET name '漫步coding'
QUEUED
127.0.0.1:6379> SET brief '一个专注于算法、数据库、职场的公众号'
QUEUED
127.0.0.1:6379> GET name
QUEUED
127.0.0.1:6379> EXEC
1) OK
2) OK
3) "漫步coding"
```

画重点, **Redis事务不支持Rollback**

事实上Redis命令在事务执行时可能会失败，但仍会继续执行剩余命令而不是Rollback（事务回滚）。如果你使用过关系数据库，这种情况可能会让你感到很奇怪。然而针对这种情况具备很好的解释：

Redis命令可能会执行失败，仅仅是由于错误的语法被调用（命令排队时检测不出来的错误），或者使用错误的数据类型操作某个Key：    这意味着，实际上失败的命令都是编程错误造成的，都是开发中能够被检测出来的，生产环境中不应该存在。（这番话，彻底甩锅，“都是你们自己编程错误，与我们无关”。）

由于不必支持Rollback,Redis内部简洁并且更加高效。


#### Redis事务执行过程

出现概率: ★★★

一个Redis事务从开始到执行会经历以下三个阶段：

- 1）开始事务。
- 2）命令放入Queue。
- 3）执行事务。

1）开始事务

MULTI命令的执行标记着事务的开始：

```
127.0.0.1:6379> MULTI
OK
```
这个命令唯一做的就是， 将客户端的 REDIS_MULTI 选项打开， 让客户端从非事务状态切换到事务状态。

2）命令放入Queue

当客户端处于非事务状态下时， 所有发送给服务器端的命令都会立即被服务器执行：

```
127.0.0.1:6379> SET name '漫步coding'
OK

127.0.0.1:6379> GET name
"漫步coding"
```

但是， 当客户端进入事务状态之后， 服务器在收到来自客户端的命令时， 不会立即执行命令， 而是将这些命令全部放进一个事务队列里， 然后返回QUEUED， 表示命令已入队：

```
 127.0.0.1:6379> MULTI
OK

127.0.0.1:6379> SET name "漫步coding"
QUEUED

127.0.0.1:6379> GET name
QUEUED
```

3）执行事务

当客户端进入事务状态之后， 客户端发送的命令就会被放进事务队列里。

EXEC 、 DISCARD 、 MULTI 和 WATCH 这四个命令 —— 当这四个命令从客户端发送到服务器时， 它们会像客户端处于非事务状态一样， 会被服务器立即执行。



#### Redis事务的一些使用场景

出现概率: ★★★

watch指令，类似乐观锁，事务提交时，如果 key 的值已被别的客户端改变，比如某个 list 已被别的客户端push/pop 过了，整个事务队列都不会被执行。（当然也可以用 Redis 实现分布式锁来保证安全性，属于悲观锁）

Redis在事务失败时不进行回滚，而是继续执行余下的命令

#### Redis事务与Redis pipeline的区别



漫步coding还在整理中, 敬请期待, 可以关注公众号: `漫步coding` 了解最新情况...

![](https://images.xiaozhuanlan.com/uploads/photo/2022/5cb0c91e-fd83-4a04-8df6-65fb602b3834.png)

